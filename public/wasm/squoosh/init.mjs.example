// 社内配布用: Squoosh コーデックの初期化ラッパ例
// 目的: Worker から import('/wasm/squoosh/init.mjs') で読み込まれ、
//       squooshEncode(bitmap, { target, quality, effort }) を提供する。

// 例では window/worker どちらでも動くように self を参照します。
const g = typeof self !== 'undefined' ? self : globalThis

// 以下は擬似コードです。実際には配布された Squoosh のバンドルに合わせて調整してください。
// （@squoosh/lib や @squoosh/codecs のエントリを自己ホストし、ここで動的 import）

// target: 'jpeg' | 'png' | 'webp' | 'avif'
// options: { quality, effort, lossless, chroma }
export async function squooshEncode(bitmap, { target, quality = 0.9, effort = 4, lossless = false, chroma = '420' } = {}) {
  // 以下は社内配布のバンドル構成に合わせて実装してください。
  // 例1) まとめてビルドされたエントリを動的import
  //   const mod = await import('/wasm/squoosh/encode.mjs')
  //   return await mod.encode(bitmap, { target, quality, effort, lossless, chroma })

  // 例2) 各コーデックを個別に初期化して呼び出す
  //   const encoders = await import('/wasm/squoosh/encoders.mjs')
  //   const { data, mime } = await encoders.encode(bitmap, { target, quality, effort, lossless, chroma })
  //   return { data, mime }

  throw new Error('[Squoosh] init.mjs not implemented. Provide squooshEncode(bitmap, opts).')
}
